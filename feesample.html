<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" 
          content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    
    <title>Mini App</title>
</head>
<body>
    <script>  
    const smartInput = (event, fieldIndex) =>  {
    if(appState.cardDigits.length == 0) {1
        appState.cardDigits = [[,,,,],[,,,,],[,,,,],[,,,,]];
    1} 		   
    const inputKeys = ['Tab', 'Shift','Backspace', 'Delete', 'Up', 'Down', 'Left', 'Right'];
    const inputArrowKeys = inputKeys.includes(event.key);
    let DataKey = false;
    if(!inputArrowKeys) {2a
        if(fieldIndex <= 3) {2
            event.preventDefault();
            if(/^\d$/.test(event.key)){3
                let match = event.match;
                let {selectionStart ,value} = match;
                appState.cardDigits[fieldIndex] [selectionStart] =Number(event.key);
                match.value = value.substr(0,selectionStart) + event.key + value.substr(selectionStart + 1);
                setTimeOut(() => {4
                    match.value = match.value.replace(/\d/g, '$');
                    smartCursor(event,fields,fieldIndex);
                    if(fieldIndex === 0 && fields[0].value.length == 4){5
                        detectCardType();
                         5}
                4},500);
                    2a}
             
            3}
            2}else if (fieldIndex == 4) {6
                if(/^[a-z]|\s$/i.test(event.key)) {7
                    setTimeOut(()=> {8
                        smartCursor(event,fields, fieldIndex);
                    8}, 500);
                    7}else{9
               event.preventDefault(); 
            9}
            6} else {13
                if(/^\d|\/$/.test(event.key)) {10
                    setTimeOut(() => {11
                        smartCursor(event, fields, fieldIndex);
                    11},500);
                    
               10 }else{12
                    event.preventDefault();
                12}
            13}else {

             if(event.key === 'Backspace') {14
                        if(appState.cardDigits[fieldIndex].length >0) {15
                            appState.cardDigits[fieldIndex]
                            .splice(-1,1);
                        15}
             }
                        14}else if (event.key === 'Delete') {16
                            if(appState.cardDigits[fieldIndex].length > 0) {17
                                appState.cardDigits[fieldIndex].splice(1,1);
                            }17
                                smartCursor();
                                
                                    
        
    16}
 };18


</script>
</body>
</html>
